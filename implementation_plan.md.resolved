# 도서관 찾기 앱 UX 대폭 개선 계획 📚🗺️

## 현재 문제점 요약

사용자가 제공한 스크린샷과 피드백을 분석한 결과, 다음과 같은 핵심 문제가 있습니다:

1. **핵심 사용 플로우 부재**: 주소지 설정 → 책 검색 → 도서관 표시 → 재고 확인이라는 핵심 플로우가 명확하지 않음
2. **주소지 입력 UX**: 현재 GPS 좌표만 표시하고, 사용자가 직접 시/군/구를 입력하는 방법이 없음
3. **검색 결과와 지도 연동 부재**: 책 검색 결과가 지도와 연결되지 않음
4. **지도 마커 정보 부족**: 도서관 마커에 해당 책의 재고/대출 가능 여부가 표시되지 않음
5. **디자인**: 카드/레이아웃이 다소 단조로움

---

## 제안하는 핵심 사용자 플로우

```
┌─────────────────────────────────────────────────────────────────┐
│  1️⃣ 주소지 설정 (시/군/구 선택)                                  │
│     └─> "서울시 강남구" 입력 또는 드롭다운 선택                    │
├─────────────────────────────────────────────────────────────────┤
│  2️⃣ 책 검색 (네이버 API)                                         │
│     └─> "해리포터" 입력 → 검색 결과 표시                          │
├─────────────────────────────────────────────────────────────────┤
│  3️⃣ 결과 확인: 지도 + 도서관 목록 (정보나루 API)                  │
│     └─> 지도 마커에 "📚 3권 보유 / ✅ 대출가능" 표시               │
│     └─> 목록에서 도서관별 상세 정보 확인                          │
│     └─> [NEW] "🏛️ 도서관 홈페이지" 버튼으로 실시간 확인 가능        │
└─────────────────────────────────────────────────────────────────┘
```

---

## Proposed Changes

### 1. 주소지 선택 기능 (Region Selector)

시/도 → 시/군/구 → 동/읍/면 순으로 선택할 수 있는 **계층형 드롭다운**을 추가합니다.

> [!IMPORTANT]
> API 매뉴얼의 `region`(지역코드)과 `dtl_region`(세부지역코드)를 활용해야 합니다.

#### [NEW] [region-selector.tsx](file:///Users/admin/Desktop/library-finder/features/region-selector/ui/region-selector.tsx)
- 시/도 선택 → 시/군/구 선택 → 선택 완료
- 선택된 지역코드를 전역 상태(Zustand)에 저장
- 드롭다운 대신 모바일 친화적인 **바텀시트** 형태도 고려

#### [NEW] [use-region-store.ts](file:///Users/admin/Desktop/library-finder/features/region-selector/lib/use-region-store.ts)
- 선택된 지역코드 상태 관리
- 지역 목록 데이터 (API 매뉴얼의 코드표 기반)

---

### 2. 통합 검색 플로우 개선

검색 시 선택된 지역과 함께 API를 호출하도록 수정합니다.

#### [MODIFY] [search-bar.tsx](file:///Users/admin/Desktop/library-finder/features/book-search/ui/search-bar.tsx)
- 주소지가 설정되지 않았으면 검색 전 주소지 설정 유도
- 검색 결과를 지도와 연동

#### [MODIFY] [use-book-search.ts](file:///Users/admin/Desktop/library-finder/features/book-search/lib/use-book-search.ts)
- `libSrchByBook` API 호출 추가: 특정 책을 소장한 도서관 목록 조회
- 지역코드(`region`)와 함께 호출

---

### 3. 지도 마커 개선 (도서관 + 재고 정보)

각 도서관 마커에 검색한 책의 재고/대출 가능 여부를 팝업 또는 라벨로 표시합니다.

#### [MODIFY] [LibraryMap.tsx](file:///Users/admin/Desktop/library-finder/features/library-map/ui/LibraryMap.tsx)
- 마커에 **커스텀 오버레이** 추가: "3권 / 대출가능" 표시
- 마커 클릭 시 상세 정보 팝업 표시
- 검색된 책 정보가 있을 때만 재고 정보 표시
- **[NEW] 팝업 내 "홈페이지 바로가기" 버튼 추가**

#### [MODIFY] [use-map-store.ts](file:///Users/admin/Desktop/library-finder/features/library-map/lib/use-map-store.ts)
- 검색된 책 정보(`searchedBook`)와 각 도서관별 재고 정보 저장
- `bookExist` API 결과를 도서관별로 매핑

---

### 4. 홈 화면 레이아웃 재설계

#### [MODIFY] [page.tsx](file:///Users/admin/Desktop/library-finder/app/page.tsx)
기존 레이아웃:
```
[ 검색바 ]
[ 위치 표시 ]
[ 지도 (공간만) ]
[ 신간/인기도서 목록 ]
```

**개선 레이아웃:**
```
┌────────────────────────────────┐
│  🏠 우리동네 도서관 찾기        │  ← 헤더
├────────────────────────────────┤
│  📍 서울시 강남구 ▼   [변경]    │  ← 주소지 선택 (탭하면 바텀시트)
├────────────────────────────────┤
│  🔍 어떤 책을 찾으세요?         │  ← 검색 입력
├────────────────────────────────┤
│  ┌──────────────────────────┐  │
│  │        🗺️ 지도          │  │  ← 지도 (도서관+재고 마커)
│  │   📚2 ✅  📚1 ❌         │  │
│  └──────────────────────────┘  │
├────────────────────────────────┤
│  📋 "해리포터" 소장 도서관 3곳   │  ← 검색 결과 요약
│  ─────────────────────────────  │
│  🏛️ 강남도서관 | 2권 | ✅ 대출  │  ← 도서관 목록 카드
│      [홈페이지에서 확인하기 >]    │  ← 교차 검증 링크
│  🏛️ 역삼도서관 | 1권 | ❌ 대출중 │
└────────────────────────────────┘
```

---

### 5. 디자인 시스템 개선

#### [MODIFY] [globals.css](file:///Users/admin/Desktop/library-finder/app/globals.css)
- 색상 팔레트 개선 (도서관 테마에 맞는 따뜻한 색상)
- 카드 그림자, 라운딩 등 시각적 개선

#### [NEW] UI 컴포넌트 스타일 개선
- 카드 컴포넌트에 호버 효과, 그림자 추가
- 버튼, 입력창 등 기본 요소 디자인 개선

---

**위 계획에 대한 피드백을 주시면 바로 구현을 시작하겠습니다!**
특히 "주소지 입력 방식"과 "지도/목록 우선순위"에 대한 의견이 중요합니다. 🙏

## 3. 검색 엔진 고도화 (Upcoming) - 🚨 중요
정보나루 API는 "대출 이력"이 있는 책만 검색되므로 신간이나 희귀본 검색이 불가능한 한계가 있습니다. 이를 `네이버 도서 검색 API`로 보완합니다.

### 아키텍처 변경 (하이브리드 검색)
정보나루 API는 "대출 실적"이 없는 도서를 검색하지 못하는 한계가 있습니다. 이를 보완하기 위해 **네이버**와 **정보나루**를 함께 사용합니다.

1. **[네이버] 책 검색**: 
   - 사용자가 입력한 검색어로 네이버 책 API 호출
   - 신간, 희귀본 등 모든 도서 정보와 정확한 ISBN 확보
2. **[정보나루] 소장/대출 확인**:
   - 확보한 ISBN으로 `libSrchByBook` API 호출
   - 내 주변 도서관의 소장 여부 및 대출 가능 상태(대출중/대출가능) 확인
   - **결과**: 지도에 도서관 마커 표시 + 소장 현황 표시

> [!NOTE]
> 이 방식은 **"책은 네이버에서 찾고, 빌리는 곳은 정보나루에서 찾는다"**는 전략입니다. 따라서 **실제 빌릴 수 있는 도서관 정보도 확실하게 제공**할 수 있습니다.
> 
> 또한, API의 실시간성 한계(1~2일 지연 가능성)를 보완하기 위해 **"도서관 홈페이지 바로가기"** 버튼을 제공하여 사용자가 출발 전 최종 확인할 수 있도록 돕습니다.

### "정밀 스캔 (Deep Scan)" 모드 도입 🕵️
정보나루의 `libSrchByBook`(소장 도서관 검색) API가 데이터를 누락하는 경우를 대비해, 사용자가 원할 때 **강제로 전수 조사를 수행**하는 기능을 제공합니다.

1. **작동 방식**: "이 지역 모든 도서관 정밀 검사" 버튼 클릭
2. **로직**:
   - 현재 선택된 지역(예: 광명시)의 **모든 도서관 코드** 목록 조회 ([getLibraries](file:///Users/admin/Desktop/library-finder/entities/library/repository/library.repository.ts#7-14))
   - 각 도서관에 대해 `bookExist` API를 병렬로 호출하여 실제 소장 여부 확인
   - 결과 병합 후 지도에 표시
3. **효과**: 정보나루 통계 데이터에 아직 반영되지 않은 **최신 입고 도서**나 **누락된 데이터**를 찾아낼 수 있음. (단, API 호출량이 많으므로 사용자 요청 시에만 실행)

### 필요 리소스
- **네이버 개발자 센터**: Client ID / Secret 발급 필요 (사용자 준비 필요)
